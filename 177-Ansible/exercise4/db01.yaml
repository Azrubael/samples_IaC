- name: Setup DBserver
  hosts: dbsrvgrp
  become: yes
  tasks:
    - name: Create a directory for downloading get-pip.py
      ansible.builtin.file:
        path: /opt/pyscripts
        state: directory
        mode: '0777'
    - name: Download Python script for installing pip
      ansible.builtin.get_url:
        url: https://bootstrap.pypa.io/pip/2.7/get-pip.py
        dest: /opt/pyscripts/get-pip.py
        mode: '0777'
    - name: Change access mode for get-pip.py
      ansible.builtin.file:
        path: /opt/pyscripts/get-pip.py
        mode: '0777'
    - name: Run script get-pip.py to install pip
      ansible.builtin.shell:
        cmd: python /opt/pyscripts/get-pip.py
    - name: Install Python PyMySQL
      ansible.builtin.shell:
        cmd: pip install PyMySQL

    - name: Install MySQL server
      yum:
        name: mariadb-server
        state: present
    - name: Start & Enable maridb service
      service:
        name: mariadb
        state: started
        enabled: yes
    - name: Create a new database with name 'accounts'
      mysql_db:
        name: accounts
        state: present
    - name: Create database user with name 'admin'
      mysql_user:
        name: admin
        password: 12345
        priv: '*.*:ALL'
        state: present
